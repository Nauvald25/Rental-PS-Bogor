<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Riwayat Booking - Rental PS Bogor</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script src="https://unpkg.com/@phosphor-icons/web@2.0.3"></script>
  <style>
  
    body {
      font-family: 'Inter', sans-serif;
  
      background: linear-gradient(to right, #0f0c29, #302b63, #24243e);
      
      color: #f8fafc; 
    }
    .pixel-font {
      font-family: 'Press Start 2P', cursive;
    }
    .header-link {
      @apply px-4 py-2 rounded-lg transition-colors duration-200;
    }
    .header-link:hover {
      @apply bg-slate-700 text-white;
    }
    .card {
      
      background-color: rgba(30, 41, 59, 0.7);
      border: 2px solid #39ff14;
      border-radius: 12px;
      box-shadow: 0 0 15px #39ff14;
    }
    .btn-pixel {
      @apply font-bold py-2 px-4 rounded-lg border-2 transition-all duration-200;
    }
    .btn-delete {
      @apply text-red-400 border-red-400 hover:bg-red-400 hover:text-black;
    }
    .btn-clear {
      @apply bg-red-600 border-red-600 text-white hover:bg-red-700;
    }
    
    .input-search {
      @apply w-full p-3 rounded-lg border-2 border-gray-600 bg-slate-900 text-white placeholder-gray-400 focus:outline-none focus:border-blue-400;
    }

    
    .input-search:focus {
      background-color: #f3f4f6;
      color: #000000; 
    }

    .modal-overlay {
      background-color: rgba(0, 0, 0, 0.7);
    }
    .modal-content {
      background: #0f0c29;
      border: 2px solid #39ff14;
      border-radius: 12px;
      color: #e0e7ff;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <header class="bg-slate-900 text-white shadow-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center">
      <h1 class="text-2xl font-bold pixel-font mb-4 md:mb-0">Rental PS Bogor</h1>
      <nav class="flex space-x-4">
        <a href="index.html" class="header-link">Beranda</a>
        <a href="paket.html" class="header-link">Paket</a>
        <a href="history.html" class="header-link bg-slate-700 text-white">Riwayat</a>
        <a href="tentang.html" class="header-link">Tentang</a>
      </nav>
    </div>
  </header>

  <main class="flex-grow py-12 px-4 md:px-8 max-w-7xl mx-auto w-full">

    <h2 class="text-4xl md:text-5xl font-bold text-center pixel-font mb-8 text-lime-300 drop-shadow-md">Riwayat Booking</h2>


    <div class="flex items-center justify-end gap-4 mb-8">
      <button id="clear-all-btn" class="btn-pixel btn-clear flex items-center gap-2">
        <i class="ph ph-trash-simple text-xl"></i> Hapus Semua
      </button>
    </div>
    
    
    <div class="relative mb-8">
    
      <input type="text" id="search-input" placeholder="Cari Berdasarkan ID, Nama, Atau Paket..." class="input-search pl-12" />
      <i class="ph ph-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-xl"></i>
    </div>

    
    <div id="history-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    
    </div>

    
    <div id="empty-state" class="hidden text-center mt-16">
      <i class="ph ph-archive text-8xl text-gray-500"></i>
      <p class="mt-4 text-xl text-gray-400">Belum Ada Riwayat Booking</p>
    </div>
  </main>

  
  <div id="confirmation-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center modal-overlay">
    <div class="modal-content p-8 max-w-md w-full mx-4 text-center">
      <i class="ph ph-warning-circle text-6xl text-yellow-400 mb-4"></i>
      <h3 class="text-2xl font-bold mb-4">Konfirmasi</h3>
      <p id="modal-message" class="mb-6 text-lg">Apakah Anda yakin ingin menghapus item ini?</p>
      <div class="flex justify-center gap-4">
        <button id="cancel-btn" class="btn-pixel bg-gray-500 text-white border-gray-500 hover:bg-gray-600">Batal</button>
        <button id="confirm-btn" class="btn-pixel bg-red-600 text-white border-red-600 hover:bg-red-700">Hapus</button>
      </div>
    </div>
  </div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const historyContainer = document.getElementById('history-container');
    const emptyState = document.getElementById('empty-state');
    const searchInput = document.getElementById('search-input');
    const clearAllBtn = document.getElementById('clear-all-btn');
    const modal = document.getElementById('confirmation-modal');
    const modalMessage = document.getElementById('modal-message');
    const confirmBtn = document.getElementById('confirm-btn');
    const cancelBtn = document.getElementById('cancel-btn');

    let historyData = [];

  
    function formatRupiah(number) {
      if (typeof number === 'string') {
        number = parseInt(number, 10);
      }
      if (isNaN(number) || number === undefined) return "Harga tidak valid";
      return new Intl.NumberFormat('id-ID', {
        style: 'currency',
        currency: 'IDR',
        minimumFractionDigits: 0
      }).format(number);
    }
    
  
    function formatDuration(durationString) {
      if (!durationString) return '';
  
      const match = durationString.match(/\d+/);
      const number = match ? parseInt(match[0], 10) : null;
      if (durationString.toLowerCase().includes('full day')) {
        return 'Full Day';
      }
      return number ? `${number} jam` : durationString;
    }
    
  
    function loadHistory() {
      const storedHistory = JSON.parse(localStorage.getItem('rental_history')) || [];
  
      storedHistory.sort((a, b) => {
        const dateA = a.waktuBooking ? new Date(a.waktuBooking) : new Date(0);
        const dateB = b.waktuBooking ? new Date(b.waktuBooking) : new Date(0);
        return dateB - dateA;
      });
      historyData = storedHistory; 
      renderHistory(historyData);
    }

    
    function renderHistory(data) {
      historyContainer.innerHTML = '';
      if (data.length === 0) {
        emptyState.classList.remove('hidden');
      } else {
        emptyState.classList.add('hidden');
        data.forEach(item => {
          const card = document.createElement('div');
          card.classList.add('card', 'p-6', 'flex', 'flex-col', 'justify-between', 'space-y-4');

    
          let tanggalMulaiFormatted = item.tanggal;
          if (item.tanggal && item.tanggal.includes('-')) {
            const [year, month, day] = item.tanggal.split('-');
            tanggalMulaiFormatted = `${day}-${month}-${year}`;
          }

    
          const formattedDuration = formatDuration(item.durasi);

          card.innerHTML = `
            <div>
              <p class="text-xl font-bold pixel-font text-lime-300">ID Booking: ${item.id}</p>
              <div class="mt-4 space-y-2 text-base">
                <p><strong>Nama:</strong> ${item.nama}</p>
                <p><strong>Paket:</strong> ${item.paket}</p>
                <p><strong>Tanggal Mulai:</strong> ${tanggalMulaiFormatted}</p>
                <p><strong>Jam Mulai:</strong> ${item.jam}</p>
                <p><strong>Tanggal Selesai:</strong> ${item.tanggalSelesai || 'Belum tersedia'}</p>
                <p><strong>Jam Selesai:</strong> ${item.waktuSelesai || 'Belum tersedia'}</p>
                <p><strong>Durasi:</strong> ${formattedDuration}</p>
                <p><strong>Harga:</strong> ${formatRupiah(item.harga)}</p>
                <p><strong>Waktu Booking:</strong> ${item.waktuBooking}</p>
              </div>
            </div>
            <div class="mt-4 flex justify-end">
              <button class="btn-pixel btn-delete" data-id="${item.id}">
                <i class="ph ph-trash-simple"></i> Hapus
              </button>
            </div>
          `;
          historyContainer.appendChild(card);
        });
      }
    }

    
    function deleteItem(id) {
      historyData = historyData.filter(item => item.id !== id);
      localStorage.setItem('rental_history', JSON.stringify(historyData));
      renderHistory(historyData);
    }

    
    function showModal(message, onConfirm) {
      modalMessage.textContent = message;
      modal.classList.remove('hidden');
      confirmBtn.onclick = () => {
        onConfirm();
        modal.classList.add('hidden');
      };
      cancelBtn.onclick = () => {
        modal.classList.add('hidden');
      };
    }

    
    historyContainer.addEventListener('click', (e) => {
      const deleteButton = e.target.closest('.btn-delete');
      if (deleteButton) {
        const bookingId = deleteButton.dataset.id;
        showModal('Apakah Anda Yakin ingin Menghapus Booking ini?', () => {
          deleteItem(bookingId);
        });
      }
    });

    
    clearAllBtn.addEventListener('click', () => {
      showModal('Apakah Anda Yakin ingin Menghapus Semua Riwayat Booking?', () => {
        localStorage.removeItem('rental_history');
        historyData = [];
        renderHistory(historyData);
      });
    });

    
    searchInput.addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      const filteredData = historyData.filter(item =>
        item.id.toLowerCase().includes(query) ||
        (item.nama && item.nama.toLowerCase().includes(query)) ||
        (item.paket && item.paket.toLowerCase().includes(query))
      );
      renderHistory(filteredData);
    });

    
    loadHistory();
  });
</script>

</body>
</html>
